---
import BaseHead from '@/components/LayoutComponents/BaseHead.astro';
import Header from '@/components/LayoutComponents/Header.astro';
import Footer from '@/components/LayoutComponents/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '@/consts';
import { getCollection } from 'astro:content';
import FormattedDate from '@/components/FormattedDate.astro';
import enBlogData from '@/data/dictionaries/en/blog.json';
import deBlogData from '@/data/dictionaries/de/blog.json';
import Layout from "@/layouts/MainLayout.astro"
import CursorWrapper from '@/components/CursorWrapper';
import { supportedLocaleArray } from '@/utils/translationUtils';

const posts = (await getCollection('blog')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

type PostParams = {
    title: string;
    description: string;
    date: string;
    image_src: string;
    slug: string;
  };

const lg_screen_width = 'lg:w-[85vw]';
const default_screen_width = 'w-[75vw]';

const translations = {
  en: enBlogData,
  de: deBlogData,
};

const { locale } = Astro.params;

const blogData = locale === 'en' ? enBlogData : deBlogData;

const mainPost = blogData.posts[0];
const otherPosts = blogData.posts.slice(1);

export async function getStaticPaths() {
  return supportedLocaleArray.map((supportedLocale) => (
    {
      params: { locale: supportedLocale }
    }
  ))
}

export const prerender = true
---

<Layout>
<div class="caret-transparent w-screen lg:py-10 min-h-[100vh]">
<CursorWrapper client:idle>
    <a href={`blog/${mainPost.slug}`} class="w-full cursor-default">
      {/* Large post Preview */}
      <div
        class={`mx-auto ${lg_screen_width} ${default_screen_width} lg:h-[625px]  text-center bg-gray-100 flex flex-col`}
      >
        {/* Image */}
        <span
          class="lg:w-full lg:h-[500px] aspect-video relative flex justify-center items-center overflow-hidden"
        >
          <img
            alt="main post image"
            src={`${mainPost.image_src}/hd1920x1080`}
            class="object-cover w-full absolute top-0 left-0 transform translate-y-[-20%]"
          />
          <div
            class="w-[95%] h-[95%] mx-auto absolute cursor-none"
            data-cursor="READ"
          >
          </div>

          {
            /*  <HoverImageWrapper src={`${mainPost.image_src}/hd1920x1080`}/> */
          }
        </span>

        <div class="p-2">
          {/*Post description */}
          <h1 class="lg:text-2xl text-base font-semibold">
            {mainPost.title}
          </h1>
          <h3 class="text-xs leading-7">{mainPost.date}</h3>
          <p class="lg:text-base text-xs tracking-wide text-muted-foreground">
            {mainPost.description}
          </p>
        </div>
      </div>
    </a>
    {/* Posts (the rest) */}
    <div
      class={`lg:mt-16 ${lg_screen_width} ${default_screen_width} mx-auto flex flex-col gap-14 mt-15`}
    >
      <div class="grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3">
        {
          otherPosts.map((post: PostParams, index: number) => {
            {
              /* Individual Post */
            }
            return (
              <a href={`${locale}/${post.slug}`}>
                <div
                  class="flex cursor-pointer flex-col gap-2 hover:opacity-75"
                >
                  <span class=" block relative aspect-video rounded-md bg-muted overflow-hidden">
                    <img
                      src={`${post.image_src}/card600x400`}
                      alt="post image"
					  class="object-cover w-full absolute top-0 left-0"
                    />
                    <div
                      class="w-[95%] h-[95%] mx-auto absolute cursor-none"
                      data-cursor="READ"
                    />
                  </span>
                  <h1 class="lg:text-xl text-sm font-bold tracking-tight">
                    {post.title}
                  </h1>
                  <p class="lg:text-base mt-[-6px] text-[13px] text-muted-foreground">
                    {post.description}
                  </p>
                </div>
              </a>
            );
          })
        }
      </div>
    </div>
    {/* View more */}
    <div class="flex justify-center w-full mt-6 mb-[60px]">
      <button
        class="border-1 border-black text-center w-fit py-2 px-5 rounded-sm"
      >
        {' '}
        View more
      </button>
    </div>
  </CursorWrapper>
</div>
</Layout>